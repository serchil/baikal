<!doctype html>
{% load staticfiles %}
{% load crispy_forms_tags %}
<html>
	<head>


		<link rel="stylesheet" href=	"{% static 'bootstrap.css' %}" type="text/css"/>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/>
<link rel="stylesheet" href="{% static 'fixed.css' %}" type="text/css">

		<link rel="stylesheet" href="{% static 'forinput.css' %}" type="text/css">

		<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
		<meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport" />
		<script src="https://vk.com/js/api/openapi.js?160" type="text/javascript"></script>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<title>Туры на Байкал</title>
		<link rel="stylesheet" href="{% static 'blog_styles.css' %}" type="text/css"/>
		<link rel="stylesheet" href="{% static 'paginator3.css' %}" type="text/css"/>
				<link rel="stylesheet" href="{% static 'tours_styles.css' %}" type="text/css"/>
					<link rel="stylesheet" href="{% static 'footer.css' %}" type="text/css"/>
					<link rel="stylesheet" href="{% static 'normolize.css' %}" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet"/>
		<link href="https://fonts.googleapis.com/css?family=Didact+Gothic" rel="stylesheet"/>
		<link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet"/>
		<link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet"/>
		<link rel="stylesheet" type="text/css" href="{% static 'multi6.min.css' %}">
		<script src="{% static 'js/mmulti.min.js' %}"></script>
	<link rel="stylesheet" href="{% static 'auth_bar2.css' %}" type="text/css">
<style>
input
{
	max-width: 430px;
}
textarea
{
		max-width: 430px;
}
.modal-body
{
	width: 85%;
}
</style>


		<script type="text/javascript" src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
<script type="text/javascript" src=" {% static 'js/jquery-ui.min.js' %} "></script>
<link rel="stylesheet" href="   {% static 'jquery-ui.min.css' %} ">


<script>
	  $(function(){
            $('.small_filter').click(function(){
                $('.first_table').toggleClass('filter_open');
            });
        });
</script>





	</head>
	<body>
		<style>
		*, ::after, ::before
		{
			box-sizing: content-box;
		}
		</style>
		<header style = "height: auto;">
			<nav id = "menu11" class="navbar navbar-expand-lg navbar-dark ">
				<a class="navbar-brand" href="#" style = "width:170px;">
					<img src="{% static "images/logotype.png" %}" alt="Logo" style=" height: 80px;">
				</a>
				<div  id = "conts" class = "header_contacts " >
					<div class = "phone1_num">
						<i class="fa fa-phone" aria-hidden="true"></i>  8&nbsp;(999)&nbsp;777&nbsp;-&nbsp;83&nbsp;-&nbsp;00
					</div>
					<div class = "loc" >
						<i class="fa fa-map-marker" aria-hidden="true" ></i>г.&nbsp;Иркутск,&nbsp;ул.&nbsp;Лермонтова,&nbsp;дом&nbsp;3
					</div>
				</div>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar1" aria-controls="navbar1" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon navbar-light"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbar1" >
					<ul class="navbar-nav  ml-auto" style = "font-size: 18px; height: auto;">
						<li class="nav-item" ><a class="nav-link"  style = "color: white;" href="{% url 'index' %}">Главная <span class="sr-only">(current)</span></a></li>
						<li class="nav-item" ><a class="nav-link"  style = "color: white;" href="{% url 'rest' %}">Отдых&nbsp;на&nbsp;Байкале</a></li>
						<li class="nav-item" ><a class="nav-link"  style = "color: white;" href="{% url 'getArticles' %}">Блог</a></li>
						<li class="nav-item" ><a class="nav-link"  style = "color: white;" href="{% url 'getTeam' %}">О&nbsp;нас</a></li>
						<li class="nav-item" id = "last" ><a class="nav-link"  style = "color: white;" href="{% url 'contacts' %}">Контакты</a></li>
            <li class=" auth" >	<a class = "username" href="{% url 'personal_account_show' %}"> {% if user.username %}{{user.username}} </a> |  <a class = "out" href = "{% url 'log_out' %}">Выйти</a>{% else %} <a class= "out" href = "{% url 'go_auth' %}">Вход</a> | <a  class= "out" href = "{% url 'registr' %}">Регистрация</a>{%endif%} {%if user.is_staff == True%}|  <a class= "out" href = "{% url 'bookingsList' %}" > В&nbsp;админку</a>{%endif%}  </li>
					</ul>

				</div>
			</nav>
		</header>
	</div>

	<div class = "backgr">

		Туры на Байкал


	</div>


	<div class = "middle">

	<ul id="breadcrumbs-one">
		<li><a href="{% url 'index' %}">Главная</a></li>
		<li class = "arrow">></li>
		<li><a href="">Туры на Байкал</a></li>


	</ul>

	</div>








	<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalCenterTitle">Добавление тура</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">


 				 		    <form method="POST" action="{% url 'add' %}" enctype="multipart/form-data" id = "contactForm2" class="post-form">{% csrf_token %}
 				 		        {{ form | crispy}}
 				 		        <button type="submit" id = "submitButton" class="submit btn btn-default" >Добавить</button>
										 <button type="submit" id = "close" class="btn btn-default" >Отменить</button>
</form>

	      </div>
	      <div class="modal-footer">

	      </div>
	    </div>
	  </div>
	</div>



















</div>

</div>

	<div class = "main_cont">
	<form action = "{% url 'getTours' %}" method = "GET">

	<div class = "filter_cont">
	<div class = "small_filter"><img src="{% static "images/filter.png" %}"></div>
	<table class = "first_table">
	<tr><td class = "h">Название</td></tr>
	<tr><td><table  class = "date_table">
	<tr><td> </td><td> <input type="text"class = "box" value= "{{filter_name}}" name="name" style = "margin-left:24px;"/></td></tr>

	</table></tr></td>
	<tr><td class = "h">Даты</td></tr>

	<tr><td><table  class = "date_table">
	<tr><td>с: </td><td> <input type="date"class = "box" value = "{{filter_date_start}}" name="dateStart"/></td></tr>
	<tr><td>по: </td><td> <input type="date"class = "box" value = "{{filter_date_end}}"    name="dateEnd"/></td></tr>
	</table></tr></td>

	<tr><td  colspan="2"  class = "h">Количество дней </td></tr>
		<tr><td><table  class = "days_table">
	<tr><td> от: </td><td> <input type="number" name="numStart" value="{{filter_num_start}}" min="1" max="12"  step="1" class = "box" ></td></tr>
		<tr><td>  до: </td><td> <input type="number" name="numEnd" value="{{filter_num_end}}" min="1" max="12"  step="1" class = "box"></td></tr>
		</table></tr></td>

	<tr><td  class = "h">Местоположение</td></tr>
	<tr><td>	<table  class = "place_table">
	<tr><td > <div class = "checks_block">
{%for p in place %}
   <p><input type="checkbox" name="check" value="{{p.name}}"  {% if p.name in filter_places %}  checked {% endif %}> {{p.name}}</p>
	 {% endfor %}


		</div>    </td></tr>
	</table></tr></td>

	<tr><td colspan="2"  class = "h">Стоимость</td></tr>

	<tr><td><table  class = "cost_table">


		<div id='options'>
	<script>
	var price_start = "{{filter_price_start}}";
	var price_end = "{{filter_price_end}}";
	var arr = [];
	if (price_start!=0 && price_end!=0){
		arr.push(Number(price_start));
		arr.push(Number(price_end));

	}
	else{
		arr.push(900);
		arr.push(10000);
	}
	jQuery(document).ready(function () {
  $( "#slider_price" ).slider({
 range: true,
 min: 900,

 max: 100000,
  step: 200,
	 values: arr,


 slide: function( event, ui ) {
 //Поле минимального значения
 $( "#price" ).val(ui.values[ 0 ]);
 //Поле максимального значения
 $("#price2").val(ui.values[1]); }
  });
  //Записываем значения ползунков в момент загрузки страницы
  //То есть значения по умолчанию
  $( "#price" ).val($( "#slider_price" ).slider( "values", 0 ));
  $("#price2").val($("#slider_price").slider( "values", 1 ));

 });


</script>



<tr><td> <table><tr><td><label for='price'>
 от:
 <input class = "box1" type="text" name="priceStart" id="price" readonly >
 </label></td></tr> </td></tr>
 <tr><td>
 <label for='price2'>
до:
 <input class = "box1" type="text" name="priceEnd"  id="price2"  >
 </label> </td></tr></table>



<div id="slider_price"></div>



		<!--<tr  ><td colspan="2"  class = "h"><input type="checkbox" style = "margin-top: 20px;" name="a" value="Малое море">Отображается</td></tr>-->
</div></td></tr>

	<tr></tr>
	</table></tr></td>



		<tr><td><table  class = "butts_table">
		<tr><td></td><td class = "butts" > <div class = "filter_buttons"> <button type="submit" class = "filter_butt" id = "btn1">Применить</button> <a  href="{% url 'getTours' %}"><button type = "button"   id = "btn2"  class = "filter_butt">Очистить</button></a > </div></td><td></td></tr>
		</table></tr></td>
		</table>
	</div>
 </form>


<div  class = "cont1">

<!--<div class = "card_button"> <a href = "#" > + Добавить тур  </a></div>-->
<h1>{{current_path}}</h1>

		<div class = "cont">
			{%  if user.is_staff %}
			<button type="button" class="btn btn-dark btn-lg" data-toggle="modal" style = "width: 200px; height:30px; border-radius: 2px;" data-target="#exampleModalCenter">
				Добавить тур
			</button>
{% endif %}


			{% if tours %}
			{% for tour in tours %}
			<div id = "card" class = "card">
		<div class = "tour_img"> <img src = "{{tour.preview_img.url}}"></div>
		<div class = "card_text">
		<p class = "main">{{tour.name}} </p>
		<div class = "card_info">

		<div class = "tour_places">
    {% for place in tour.places.all %}
		<div class = "place"> <a href = "{% url 'placeCard' place.id %}"> {{place.name}} </a></div>
  {% endfor %}
		</div>


		</div>
		<p class = "card_description">{{tour.preview_descr}}<p/>
		<div class = "priceAndButton">
		<div class = "tour_price">Цена:&nbsp;<span>{{tour.min_price}}&nbsp;</span> ₽</div>
		<div class = "card_button"> <a href = "{% url 'tourCard' tour.url  %}" > Подробнее </a></div>
		</div>
		</div>

		</div>

        {% endfor %}





				</div>
<div class = "cont">
<div id="pagination"></div>
</div>

	{% else %}
	<p>Туры по заданным условиям не найдены.</p>
	{% endif %}


		</div>

	</div>





</div>
		<footer>
		<div class = "footer_main_cont">
		<div class = "footer_first_con">

		<div class = "footer_contacts">

		<p>тел.:8&nbsp;(999)&nbsp;777&nbsp;-&nbsp;83&nbsp;-&nbsp;00</p>
		<p>г.&nbspИркутск, ул.&nbspЛермонтова, дом&nbsp3</p>
		<p>E-mail: qqqq@mail.ru</p>
		</div>

		<div class = "footer_nav">
		<nav class = "nav_class">


		<a href="{% url 'getTours' %}">Туры</a> <a href="{% url 'getPlaces' %}">Направления</a> <a href="{% url 'getHotels' %}">Проживание</a> <a href="{% url 'transfer' %}">Трансфер</a><a href="{% url 'getArticles' %}">Блог</a><a href="{% url 'getTeam' %}">О&nbspнас</a><a href="{% url 'contacts' %}">Контакты</a>


		</nav>
		</div>

		<div class = "footer_social">

		<div class = "footer_social_icons">
		<div class = "icons_h">Мы в соц сетях: </div>
		<div class = "iconsSoc">
		<img src="{% static "images/vk.png" %}">
		<img src="{% static "images/inst.png" %}">
		<img src="{% static "images/facebook.png" %}">
		</div>
		</div>
		<!--
		<div class = "footer_logo">
		<img id="footer_logo" src="http://demiart.ru/forum/uploads7/post-802773-1311062308.png" >
		</div>
		-->
		</div>


		</div>



		<div class = "footer_sec_con">
		<p>Агентство путешествий Resort </p>
		</div>





		</div>

		</footer>




		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

















		<script>/* * * * * * * * * * * * * * * * *
		 * Pagination
		 * javascript page navigation
		 * * * * * * * * * * * * * * * * */
		var qw = "{{base_url}}"
		var Pagination = {

		    code: '',

		    // --------------------
		    // Utility
		    // --------------------

		    // converting initialize data
		    Extend: function(data) {
		        data = data || {};
		        Pagination.size = data.size || 300;
		        Pagination.page = data.page || 1;
		        Pagination.step = data.step || 10;
		    },

		    // add pages by number (from [s] to [f])
		    Add: function(s, f) {
		        for (var i = s; i < f; i++) {
								q = i.toString()
								console.log("${i}")
		            Pagination.code += "<a href = '?page="+i+qw+"'>" + i + "</a>";

		        }
		    },

		    // add last page with separator
		    Last: function() {
		        Pagination.code += '<i>...</i><a href = "?page='+Pagination.size+'">' + Pagination.size + '</a>';
		    },

		    // add first page with separator
		    First: function() {
		        Pagination.code += '<a href = "?page=1">1</a><i>...</i>';
		    },



		    // --------------------
		    // Handlers
		    // --------------------

		    // change page
		    Click: function() {
		        Pagination.page = +this.innerHTML;
		        Pagination.Start();

		    },

		    // previous page
		    Prev: function() {
		        Pagination.page--;
		        if (Pagination.page < 1) {
		            Pagination.page = 1;
		        }
		        Pagination.Start();
		    },

		    // next page
		    Next: function() {
		        Pagination.page++;
		        if (Pagination.page > Pagination.size) {
		            Pagination.page = Pagination.size;
		        }
		        Pagination.Start();
		    },



		    // --------------------
		    // Script
		    // --------------------

		    // binding pages
		    Bind: function() {
		        var a = Pagination.e.getElementsByTagName('a');
		        for (var i = 0; i < a.length; i++) {
		            if (+a[i].innerHTML === Pagination.page) { a[i].className = 'current'; now = i;}
		            a[i].addEventListener('click', Pagination.Click, false);
		        }
		    },

		    // write pagination
		    Finish: function() {
		        Pagination.e.innerHTML = Pagination.code;
		        Pagination.code = '';
		        Pagination.Bind();
		    },

		    // find pagination type
		    Start: function() {
		        if (Pagination.size < Pagination.step * 2 + 6) {
		            Pagination.Add(1, Pagination.size + 1);
		        }
		        else if (Pagination.page < Pagination.step * 2 + 1) {
		            Pagination.Add(1, Pagination.step * 2 + 4);
		            Pagination.Last();
		        }
		        else if (Pagination.page > Pagination.size - Pagination.step * 2) {
		            Pagination.First();
		            Pagination.Add(Pagination.size - Pagination.step * 2 - 2, Pagination.size + 1);
		        }
		        else {
		            Pagination.First();
		            Pagination.Add(Pagination.page - Pagination.step, Pagination.page + Pagination.step + 1);
		            Pagination.Last();
		        }
		        Pagination.Finish();
		    },



		    // --------------------
		    // Initialization
		    // --------------------

		    // binding buttons

		    Buttons: function(e) {
		        var nav = e.getElementsByTagName('a');
		        nav[0].addEventListener('click', Pagination.Prev, false);
		        nav[1].addEventListener('click', Pagination.Next, false);
		    },

		    // create skeleton
		    Create: function(e) {
console.log(Pagination.page);
var next = Pagination.page+1;
var back = Pagination.page-1;
var q = "{{base_url}}"
if (Pagination.page!= {{ tours.paginator.num_pages }})
{
		        var html = [
       					'<a  href = "?page='+ back+ q+'"> &#9668;</a>',
								 '<span></span>',  // pagination container
		            '<a  href = "?page='+ next +q+'">&#9658;</a>',


		        ];
}
else
{
	var html = [
			'<a  href = "?page='+ back +q+'"> &#9668;</a>',
			 '<span></span>',  // pagination container
			  '<a style = "display:none;"></a>',



	];
}
if (Pagination.page== 1)
{

	var html = [
	'<a style = "display:none;"></a>',
			 '<span></span>',  // pagination container
			'<a  href = "?page='+ next + q+'">&#9658;</a>',


	];


}




		        e.innerHTML = html.join('');
		        Pagination.e = e.getElementsByTagName('span')[0];
		        Pagination.Buttons(e);
		    },

		    // init
		    Init: function(e, data) {
		        Pagination.Extend(data);
		        Pagination.Create(e);
		        Pagination.Start();
		    }
		};



		/* * * * * * * * * * * * * * * * *
		* Initialization
		* * * * * * * * * * * * * * * * */

		var init = function() {
		    Pagination.Init(document.getElementById('pagination'), {
		        size: {{ tours.paginator.num_pages }}, // pages size
		        page: {{ tours.number }},  // selected page

		        step: 3   // pages before and after current
		    });	console.log("now is" + now);
		};

		document.addEventListener('DOMContentLoaded', init, false);

		</script>
		<script>
		var srcData = ""
		function encodeImageFileAsURL() {

			var filesSelected = document.getElementById("inputFileToLoad").files;
			if (filesSelected.length > 0) {
				var fileToLoad = filesSelected[0];

				var fileReader = new FileReader();

				fileReader.onload = function(fileLoadedEvent) {
					srcData = fileLoadedEvent.target.result; // <--- data: base64

					var newImage = document.createElement('img');
					newImage.src = srcData;



					console.log(srcData);
				}
				fileReader.readAsDataURL(fileToLoad);
			}
		}


		$(function(){
		        $('#contactForm').submit(function(e){


							var form = document.getElementById('form-id');
							var formData = new FormData(form);

		    //отменяем стандартное действие при отправке формы
		            e.preventDefault();
		    //берем из формы метод передачи данных
		            var m_method=$(this).attr('method');
		    //получаем адрес скрипта на сервере, куда нужно отправить форму
		            var m_action=$(this).attr('action');
		    //получаем данные, введенные пользователем в формате input1=value1&input2=value2...,
		    //то есть в стандартном формате передачи данных формы
		            var m_data=$(this).serialize();
								m_data = m_data.concat("&image="+srcData.substr(23, srcData.length));




		            $.ajax({
		                type: m_method,
		                url: m_action,
		                data: m_data,




		                success: function(result){
		                    console.log(m_data.length);
												console.log("kjhgf");


		                }
		            });

 console.log(m_data)
					  });


		    });



		</script>


<script>

		$(function(){
						$('#contactForm2').submit(function(e){



var form = new FormData(document.getElementById("contactForm2"));
				//отменяем стандартное действие при отправке формы
								e.preventDefault();
				//берем из формы метод передачи данных
								var m_method=$(this).attr('method');
				//получаем адрес скрипта на сервере, куда нужно отправить форму
								var m_action=$(this).attr('action');
				//получаем данные, введенные пользователем в формате input1=value1&input2=value2...,
				//то есть в стандартном формате передачи данных формы
								var m_data=$(this).serialize();
								m_data = m_data.concat("&image="+srcData.substr(23, srcData.length));
$form = $(this)
								var formData = new FormData(this);


								$.ajax({
										type: 'POST',
										url: m_action,
										data: formData,
										contentType: false,
										processData: false,



										success: function(data){

var d=-1;
try{
 d = data.indexOf("Already exist");

}
catch(e)
{

}
if (d != -1)
{
				alert("Тур с таким URL уже существует"+d);
}
else {

		$('#exampleModalCenter').modal('hide');
		 $.clearInput();
		 console.log(data);
		 var arr = data["newTours"];
var place_arr = data["resultPlaceList"];
console.log(place_arr[0]);


var elem1 = document.getElementsByClassName('cont')[0];
var theFirstCard = document.getElementsByClassName('card')[0];

if (arr[arr.length-1].activity_status)

{
	var placeElem = "";
	for (var i = 0; i< place_arr.length; i++)
	{
		placeElem +='<div class = "place"> <a href = "../placeCard/'+place_arr[i].id+'"> '+place_arr[i].name+' </a></div>';
	}
var newElem = document.createElement('div');
	newElem.className = "card";

newElem.innerHTML = ' <div class = "tour_img"> <img src = "../media/'+arr[arr.length-1].preview_img+'"></div> <div class = "card_text"> <p class = "main">'+arr[arr.length-1].name+' </p> <div class = "card_info"> <div class = "tour_places"> '+placeElem+' </div><p class = "card_description">'+arr[arr.length-1].preview_descr+'<p/> <div class = "priceAndButton"> <div class = "tour_price">Цена:&nbsp;<span>'+arr[arr.length-1].min_price+'&nbsp;</span> ₽</div> <div class = "card_button"> <a href = "../tourCard/'+arr[arr.length-1].url+'" > Подробнее </a></div> </div> ';
elem1.insertBefore(newElem, theFirstCard);
//elem1.append(newElem);
}



//elem1.outerHTML+=('	<div class = "tour_img"> <img src = "../media/'+arr[arr.length-1].preview_img+'"></div>	<div class = "card_text">	<p class = "main">'+arr[arr.length-1].name+' </p>	<div class = "card_info">	<div class = "tour_places"></div></div>	<div class = "priceAndButton"></div></div>');
}
}




})
								});

						});






		</script>







		<script type='text/javascript'>

		$( document ).ready(function() {
			var b = document.querySelector("#id_places");
			b.setAttribute("multiple", "multiple");
			var a = document.querySelector("#id_slider");
			b.setAttribute("multiple", "multiple");
		});





		</script>
			<script type='text/javascript'>
						 var select = document.getElementById("id_places");
						 multi(select, {
								 non_selected_header: "Направления тура",
								 selected_header: "Выбранное"
						 });
				 </script>


		 			<script type='text/javascript'>
		 						 var select = document.getElementById("id_slider");
		 						 multi(select, {
		 								 non_selected_header: "Изображение",
		 								 selected_header: "Выбранное"
		 						 });
		 				 </script>


						 <script>


				 		$.clearInput = function () {











									$('form').find('input[type=text], input[type=password], input[type=number], input[type=email], textarea, input[type=file], input[type=checkbox]').val([]);



		 						 var c= document.querySelectorAll('a.item.selected');
		 				console.log(c);
		 				console.log(c.length);


		 for (var i = 0; i<c.length; i++)
		 {


		 }











				 	 };


				 	 $( document ).ready(function(){
				 		$( "#close" ).click(function(){ // задаем функцию при нажатиии на элемент <button>
				 		$('#exampleModalCenter').modal('hide');
				 		$.clearInput();
				 		});
				 	 });



				 		</script>

<script>
window.addEventListener( "pageshow", function ( event ) {
  var historyTraversal = event.persisted ||
                         ( typeof window.performance != "undefined" &&
                              window.performance.navigation.type === 2 );
  if ( historyTraversal ) {
    // Handle page restore.
    window.location.reload();
  }
});


</script>

	</body>
	</html>
