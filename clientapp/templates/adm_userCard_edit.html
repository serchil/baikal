<!doctype html>
{% load staticfiles %}
<html>
<head>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Редактирование пользователя</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="{% static 'paginator3.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'adm-header-style.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'footer.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'normolize.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'adm-adapt.css' %}" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Didact+Gothic" rel="stylesheet">
<link rel="stylesheet" href="{% static 'bootstrap.css' %}" type="text/css">

		<link rel="stylesheet" href="{% static 'forinput.css' %}" type="text/css">

<link rel="stylesheet" href="{% static 'adm_tour_card_style.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'adm_PlaceCard_style.css' %}" type="text/css">



<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
	</head>
	<body> <style>.fa:hover{cursor: pointer;}</style>


    <header>
      <nav id = "list" class="navbar navbar-expand-lg navbar-dark " style = "background-color: rgba(37, 115, 187, 0.9); display:flex; flex-direction: column;">

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar1" aria-controls="navbar1" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon navbar-light"></span>
        </button>


        <div class="collapse navbar-collapse" id="navbar1" >
          <ul  class="navbar-nav  ml-auto" style = "display:flex; flex-direction: column;">
            <div class = "menuPart"style = "display: flex;  ">
							<li id = "el"  class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'bookingsList' %}">Бронирования</a></li>

							<li id = "el" class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'userList'%}">Пользователи</a></li>
							<li id = "el"  class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'getTours' %}">Туры</a></li>
							<li id = "el"  class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'getHotels' %}">Гостиницы</a></li>
							<li id = "el"  class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'getPlaces' %}">Места</a></li>
							<li id = "el" class="nav-item"><a class="nav-link"  style = "color: white;" href="{% url 'timetableList' %}">Расписание</a></li>





            </div>
          </ul>

        </div>
      </nav>
    </header>


		<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">Административная панель </a></li>
	      <li class="breadcrumb-item"><a href="{%url 'userList'%}">Пользователи</a></li>
		   <li class="breadcrumb-item"><a href="{% url 'getUserCard' userCard.id %}">Карточка пользователя</a></li>
    <li class="breadcrumb-item active" aria-current="page">Редактирование пользователя</li>
  </ol>
</nav>
		<div>
	<hr style = "height: 1 px; width: 300px; background-color:#6666ff">
		<h2 style = "text-align: center;">Редактирование пользователя</h2>
		</div>





	<div class = "container" id = "cont_card" style = "max-width: 750px; border: 1px solid black;background-color:#f5f5f5; " >
		<div class = "row">

		<div class = "col-md-12" >

		 <div class = "row mt-4">


					<div class = "col-sm-2"><label for="name"></label></div>
					<div class = "col-sm-2"><label for="name">Фамилия:</label></div>
					<div class = "col-sm-6"><input type="name" id="surname" class="form-control mt-2"  value="{{userCard.surname}}"id="validationServer01" required>
					</div>

				</div>
				<div class = "row">

							<div class = "col-sm-2"><label for="name"></label></div>
					<div class = "col-sm-2"><label for="name">Имя:</label></div>
					<div class = "col-sm-6"><input type="name" id="name" class="form-control mt-2" value ="{{userCard.name}}" id="validationServer01" required>
					</div>

				</div>


					<div class = "row ">

							<div class = "col-sm-2"><label for="name"></label></div>
					<div class = "col-sm-2"><label for="name">E-mail:</label></div>
					<div class = "col-sm-6"><input type="name" id="email" class="form-control mt-2" value="{{userCard.email}}" id="validationServer01" required>
					</div>

				</div>
					<div class = "row ">

							<div class = "col-sm-2"><label for="name"></label></div>
					<div class = "col-sm-2"><label for="name">Телефон:</label></div>
					<div class = "col-sm-6"><input type="name" id="phone_number" class="form-control mt-2" value="{{userCard.phone_number}}" id="validationServer01" required>
					</div>

				</div>



	<div class = "row ">

			<div class = "col-sm-2"><label for="name"></label></div>
		<div class = "col-sm-6">Изменить пароль<input class="mr-3 mt-3 mb-3 ml-3" type ="checkbox" id="change_pass"></div>





</div>

				<div class = "row " >

						<div class = "col-sm-2"><label for="name"></label></div>
				<div class = "col-sm-2"><label for="name">Пароль:</label></div>
				<div class = "col-sm-6" ><input type="password" id="password" class="form-control mt-2" value=""  disabled>
				</div>



			</div>



		<div class = "row ">
					<div class = "col-sm-2"></div>

					<div class = "col-sm-2"><label for="name">Тип пользователя:</label></div>
					<div class = "col-sm-6 mt-3"><div class="col-xs-6 " >
  <select id ="type" class="form-control" name="select2" id="select2">
{% if userCard.is_staff %}
    <option value="1">Клиент</option>
    <option selected value="2">Сотрудник</option>
{% else %}
<option selected value="1">Клиент</option>
<option  value="2">Сотрудник</option>
{% endif %}
</select>
</div>
					</div>


				</div>


        <div class = "row mt-3">
<div class = "col-sm-3 mb-3"></div>
<div class = "col-sm-6 mb-3">
<a class="btn   btn-outline-secondary  popup-open"  >Удалить</a>
<a type="button" class="btn btn-secondary" href = "{% url 'userList' %}">Отменить </a>

<button class="btn btn-primary" onclick="editUserCard()" type="submit">Сохранить</button>
</div>
<div class = "col-lg-4 col-md-4  "></div>
</div>




 </div>









 </div>




		</div>





		<div class="popup-fade"	>
				<div class="popup" style="	box-sizing: content-box;">

						<p>Вы уверены что хотите удалить данного пользователя?</p>
						<a class="btn btn-outline-dark"  href = "{% url 'del_user' userCard.id %}">Удалить</a>
						<a type="button" class="btn btn-secondary popup-close" href = "">Отменить </a>


				</div>
		</div>


				<style>
				.popup-fade {
						display: none;
				}
				.popup-fade:before {
						content: '';
						background: #000;
						position: fixed;
						left: 0;
						top: 0;
						width: 100%;
						height: 100%;
						opacity: 0.7;
						z-index: 9999;
				}
				.popup {
						position: fixed;
						display: flex;
						flex-direction: column;
						justify-content: space-between;
						height: 160px;
						top: 20%;
						left: 50%;
						padding: 20px;
						width: 360px;
						margin-left: -200px;
						background: #fff;
							border: 1px solid black;
						border-radius: 2px;
						z-index: 99999;
						opacity: 1;
				}

				</style>

				<script>

						$('#change_pass').click(function() {
							if ($('#change_pass').is(':checked')){
								document.getElementById("password").disabled = false;
								console.log("vkl");
							} else {
document.getElementById("password").disabled = true;
							}
						});




// 				function make_password_visible(){
// var label = document.getElementById("change_pass");
//
//
// 					if (label.innerHTML == "Не изменять пароль")
// 				{
// 					console.log("dgfe");
//
// 				//	document.getElementById("change_pass").outerHTML = '<div onclick="make_password_visible()" id="change_pass"class = "col-sm-6 mt-2">Изменить пароль</div>';
// 					document.getElementById("change_pass").innerHTML = "Изменить пароль";
// 					document.getElementById("password").disabled = true;
// 				}
//
// 				if(document.getElementById("change_pass").innerHTML == "Изменить пароль")
// 			{	document.getElementById("password").disabled = false;
//
//
// 			document.getElementById("change_pass").innerHTML = "Не изменять пароль";
// 			}
//
// 				}
				$(document).ready(function($) {
					console.log("d");
						$('.popup-open').click(function() {
								$('.popup-fade').fadeIn();
									console.log("d");
								return false;
						});

						$('.popup-close').click(function() {
								$(this).parents('.popup-fade').fadeOut();
								return false;
						});

						$(document).keydown(function(e) {
								if (e.keyCode === 27) {
										e.stopPropagation();
										$('.popup-fade').fadeOut();
								}
						});
						$('.popup-fade').click(function(e) {
								if ($(e.target).closest('.popup').length == 0) {
										$(this).fadeOut();
								}
						});
				});
				</script>

						<script>
						function getCookie(csrfmiddlewaretoken) {
						    var cookieValue = null;
						    if (document.cookie && document.cookie !== '') {
						        var cookies = document.cookie.split(';');
						        for (var i = 0; i < cookies.length; i++) {
						            var cookie = jQuery.trim(cookies[i]);
						            // Does this cookie string begin with the name we want?
						            if (cookie.substring(0, name.length + 1) === (name + '=')) {
						                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						                break;
						            }
						        }
						    }
						    return cookieValue;
						}

				function editUserCard()
				{
				  $.ajaxSetup({
				     beforeSend: function(xhr, settings) {
				         function getCookie(name) {
				             var cookieValue = null;
				             if (document.cookie && document.cookie != '') {
				                 var cookies = document.cookie.split(';');
				                 for (var i = 0; i < cookies.length; i++) {
				                     var cookie = jQuery.trim(cookies[i]);
				                     // Does this cookie string begin with the name we want?
				                     if (cookie.substring(0, name.length + 1) == (name + '=')) {
				                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
				                         break;
				                     }
				                 }
				             }
				             return cookieValue;
				         }
				         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
				             // Only send the token to relative URLs i.e. locally.
				             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
				         }
				     }
				});

				var userType = 0;
				if (document.getElementById("type").value == 1)
				{
					userType = "Клиент";
				}
				if (document.getElementById("type").value == 2)
				{
					userType = "Сотрудник";
				}
				console.log(document.getElementById("name").value);
				console.log(document.getElementById("surname").value);
				console.log(document.getElementById("phone_number").value);
				console.log(document.getElementById("email").value);
				console.log(document.getElementById("password").value);



						$.ajax({

								type: 'POST',
								url: "{% url 'ediUserCard' userCard.id %}",
								data:{
									'csrfmiddlewaretoken': getCookie("csrftoken"),

									name: document.getElementById("name").value,
									surname:	document.getElementById('surname').value,
									phone_number: document.getElementById('phone_number').value,
									email: document.getElementById('email').value,
									password: document.getElementById('password').value,
									type: userType,
								},
							success: function(data){
				window.location.href='../../userList/';

					},
					error: function(){
						alert('error');
					}

					})


					}
</script>








    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		</body>
		</html>
